# Join League UI Documentation

## Overview

The JoinLeague component provides a form for users to join an existing league using a join code. Upon successful join, the user is added as a player and redirected to the league home page.

## Component Location

**File**: `src/Components/JoinLeague.js`

**Route**: `/join-league`

**Access**: Clicked from User Dashboard "Join Existing League" button

---

## Purpose

- Collect join code from user
- Submit join request to backend
- Add user as player in league
- Redirect to newly joined league

---

## State Management

**Local State** (lines 8-11):

```javascript
const [joinCode, setJoinCode] = useState('');
const [username, setUsername] = useState(null);
const [loading, setLoading] = useState(false);
const [error, setError] = useState(null);
```

**State Purposes**:
- `joinCode`: User input for 9-character code
- `username`: Logged-in user's email
- `loading`: Form submission state
- `error`: Error message if join fails

---

## Key Functions

### 1. useEffect - Get Username

**Location**: Lines 13-31

**Purpose**: Fetch logged-in username on component mount

**API Call** (line 19):
```javascript
GET /check_logged_in
```

**Response Handling** (lines 23-25):
- Sets username state
- Used in join league request

**Error Handling** (lines 26-28):
- Logs error to console

**Dependencies**: `[]` (line 30) - Runs once on mount

---

### 2. handleSubmit()

**Location**: Lines 33-79

**Purpose**: Submit join league request

**Validation** (lines 36-39):
- Check join code not empty
- Alert if empty

**API Call** (lines 41-58):
```javascript
POST /join_league
Body: { joinCode, username }
```

**Success Handling** (lines 60-68):
- Alert: "Successfully joined league!"
- Navigate to league home page
- Format: `/league-home/${data.league.league_name}`

**Error Handling** (lines 69-75):
- Shows error message from backend
- Sets error state
- Logs to console

**CRITICAL**: Includes `credentials: 'include'` (line 48)

---

## Form UI

**Location**: Lines 82-139

**Container**: Centered card with max width, shadow

**Form Elements**:

**Title** (lines 90-92):
```
Join Existing League
```

**Join Code Input** (lines 94-108):
- Label: "Join Code"
- Placeholder: "Enter 9-character join code"
- Required field
- Updates joinCode state on change
- Uppercase recommended (backend normalizes)

**Error Display** (lines 110-114):
- Shows error message in red text
- Only visible if error state is set

**Submit Button** (lines 116-132):
- Green background
- Full width
- Disabled when loading
- Text: "Join League" or "Joining..." (when loading)
- Calls handleSubmit on click

**Cancel Button** (lines 134-137):
- Gray background
- Navigates back to user home
- Text: "Cancel"

---

## Common Errors

### 1. "League not found"

**Cause**: Join code doesn't match any league

**Common Reasons**:
- Typo in join code
- Code was regenerated by commissioner
- League was deleted

**Backend Response**: 404 error

**Display**: Error message shown below input (lines 110-114)

---

### 2. "Player already exists in the league"

**Cause**: User already joined this league

**Backend Response**: 400 error

**Expected Behavior**: Should redirect to league home instead

**Prevention**: Check user's leagues before showing form

---

### 3. Join code case sensitivity

**Note**: Join codes stored as uppercase in backend

**User Experience**: Users may enter lowercase

**Handling**: Backend should normalize to uppercase, or frontend converts before sending

---

## API Integration

### Endpoints Used

**1. GET /check_logged_in** (line 19)
- Get current user's username
- Response: `{ username: "user@gmail.com" }`

**2. POST /join_league** (line 41)
- Join existing league
- Body: `{ joinCode, username }`
- Response: `{ message, league: { league_name, join_code, ... } }`

**CRITICAL**: All requests include `credentials: 'include'`

---

## Success Flow

1. User receives join code from friend/commissioner
2. User clicks "Join Existing League" on dashboard
3. User enters join code in form
4. Clicks "Join League"
5. Loading state activates (button shows "Joining...")
6. Backend validates code and creates Player record
7. Frontend shows success alert
8. User clicks OK on alert
9. Navigates to league home page

**Success Alert** (line 64):
```javascript
alert('Successfully joined league!');
```

---

## User Experience Tips

### Sharing Join Codes

**Commissioner Side**:
- Join code displayed on league home page
- Can copy to clipboard
- Share via text, email, etc.

**Player Side**:
- Receives code from commissioner
- Enters in this form
- Immediately joins league

### Join Code Format

**Standard Format**: 9 alphanumeric characters (e.g., "ABC123XYZ")

**Case**: Uppercase recommended but backend should handle both

**Input Validation**: Could add maxLength="9" to input field

---

## Related Components

- [User Dashboard](./user-dashboard.md) - Links to this page
- [League Home](./league-home.md) - Destination after joining
- [Create League](./league-create-ui.md) - Alternative path

---

## Backend Integration

- [Join League](../../playoff-pickem-backend/docs/league-join.md) - Backend workflow
- [Join Code Validation](../../playoff-pickem-backend/docs/league-join.md#join-code-validation) - How codes are validated

---

*Last Updated: January 2026*
